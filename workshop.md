# 1. EE Objects and Methods
```js
// =================================================================================
// TODO 1: การสร้าง Object ของ Earth Engine
// ในส่วนนี้ เราจะเรียนรู้วิธีการสร้าง Object พื้นฐานใน Earth Engine
// เช่น Geometry ซึ่งเป็นตัวแทนของพื้นที่บนแผนที่
// =================================================================================

// สร้าง Object ประเภทรูปหลายเหลี่ยม (Polygon) จากพิกัดที่กำหนด
// พิกัดอยู่ในรูปแบบ [ลองจิจูด, ละติจูด]

var geometry = ee.Geometry.Polygon([
  [
    [99.74963537611364, 17.112622728755497],
    [99.74963537611364, 16.753273777391442],
    [100.12022667481904, 16.753273777391442],
    [100.12022667481904, 17.112622728755497],
    [99.74963537611364, 17.112622728755497]
  ]
]);

print('Geometry:', geometry);

// =================================================================================
// TODO 2: การสร้าง Feature และการกำหนดคุณสมบัติ (Properties)
// Feature คือ Geometry ที่มีข้อมูลคุณสมบัติแนบไปด้วย
// เราสามารถเพิ่มข้อมูลต่างๆ เช่น ชื่อ, รหัสพื้นที่, หรือค่าที่วัดได้
// =================================================================================

// สร้าง Feature จาก 'geometry' ที่เราสร้างไว้ก่อนหน้า
// พร้อมกับกำหนดคุณสมบัติ (property) 'name' ให้มีค่าเป็น 'Sukhothai'

// var feature = ee.Feature(geometry, {
//   name: 'Sukhothai Extent',
//   household: 389,
//   population: 3500,
//   elevation: 45
// });

// แสดงผลข้อมูล Feature ในหน้าต่าง Console
// print('Feature:', feature);


// =================================================================================
// TODO 3: การเรียกใช้ Method ของ Object และการแปลงหน่วย
// Object ใน Earth Engine มีฟังก์ชัน (Method) ที่เราสามารถเรียกใช้เพื่อประมวลผลได้
// ตัวอย่างเช่น การคำนวณพื้นที่ของ Geometry และการแปลงหน่วยพื้นที่
// =================================================================================

// เรียกใช้ method .geometry() เพื่อเข้าถึงรูปทรงของ feature
// จากนั้นเรียก .area() เพื่อคำนวณพื้นที่ (หน่วยพื้นฐานคือตารางเมตร)
// var area_sqm = feature.geometry().area();

// แปลงหน่วยจากตารางเมตรเป็นตารางกิโลเมตร (1 ตร.กม. = 1,000,000 ตร.ม.)
// var area_sqkm = area_sqm.divide(1000 * 1000);

// แปลงหน่วยจากตารางเมตรเป็นไร่ (1 ไร่ = 1,600 ตร.ม.)
// var area_rai = area_sqm.divide(1600);

// แสดงผลค่าพื้นที่ที่คำนวณได้ในหน่วยต่างๆ ที่หน้าต่าง Console
// print('Area (square meters):', area_sqm);
// print('Area (square kilometers):', area_sqkm);
// print('Area (Rai):', area_rai);


// =================================================================================
// TODO 4: การจัดการการแสดงผลบนแผนที่ (Map)
// เราสามารถควบคุมการแสดงผลบนแผนที่ได้ เช่น การซูมไปยังพื้นที่ที่สนใจ
// และการเพิ่มชั้นข้อมูล (Layer) เพื่อแสดงผล Object ของเรา
// =================================================================================

// สั่งให้แผนที่ซูมไปยังศูนย์กลางของ 'feature' ด้วยระดับการซูมที่ 10
// Map.centerObject(feature, 10);

// เพิ่ม 'feature' ของเราลงบนแผนที่ให้เป็นชั้นข้อมูลใหม่
// พร้อมกำหนดค่าการแสดงผล เช่น สีของพื้นที่
// และตั้งชื่อ Layer ว่า 'Sukhothai Extent'
// Map.addLayer(feature, {
//   color: 'red'
// }, 'Sukhothai Extent');

```
----

# 2. Earth Engine objects for image and image collection
## 2.1 ImageCollection
```js
// =================================================================================
// TODO 1: สร้างและกรองชุดข้อมูลภาพ (ImageCollection)
// ในส่วนนี้ เราจะเรียนรู้การทำงานกับชุดข้อมูลภาพถ่ายดาวเทียมหลายๆ ภาพ
// =================================================================================

// 1.1 สร้าง Object ประเภท ImageCollection จากชุดข้อมูล Landsat 9
// และกรองข้อมูล (filter) เฉพาะภาพที่ถ่ายในช่วงวันที่ 1 ม.ค. - 31 มี.ค. 2024
var dataset = ee.ImageCollection('LANDSAT/LC09/C02/T1_TOA')
  .filterDate('2024-01-01', '2024-03-31');


// =================================================================================
// TODO 2: เตรียมข้อมูลสำหรับการแสดงผล
// หลังจากได้ชุดข้อมูลที่กรองแล้ว เราจะเลือกแบนด์และตั้งค่าการแสดงผล
// =================================================================================

// 2.1 เลือกแบนด์ที่ต้องการแสดงผล (B4=Red, B3=Green, B2=Blue) จากทุกภาพใน Collection
// var trueColor432 = dataset.select(['B4', 'B3', 'B2']);

// 2.2 กำหนดค่าพารามิเตอร์สำหรับการแสดงผล (Visualization Parameters)
// เพื่อปรับความสว่างและความคมชัดของภาพ
// var trueColor432Vis = {
//   min: 0.0,
//   max: 0.4,
// };


// =================================================================================
// TODO 3: แสดงผลลัพธ์บนแผนที่
// ขั้นตอนสุดท้ายคือการกำหนดมุมมองและเพิ่มชั้นข้อมูล (Layer) ลงบนแผนที่
// =================================================================================

// 3.1 กำหนดจุดศูนย์กลางและระดับการซูมของแผนที่
// Map.setCenter(99.9109, 16.9294, 9);

// 3.2 เพิ่ม Layer ของ ImageCollection ที่ผ่านการกรองและเลือกแบนด์แล้ว
// GEE จะทำการรวมภาพ (mosaic) ที่ดีที่สุดในช่วงเวลาที่เราเลือกมาแสดงผลโดยอัตโนมัติ
// Map.addLayer(trueColor432, trueColor432Vis, 'True Color (432)');

```
---
## 2.2 Image
```js
// =================================================================================
// TODO 1: กำหนดเงื่อนไขการค้นหาภาพถ่ายดาวเทียม
// ในส่วนนี้ เราจะกำหนดค่าต่างๆ เพื่อใช้ในการกรองข้อมูล
// =================================================================================

// 1.1 ระบุ Path และ Row ของพื้นที่ที่สนใจ
var path = 130;
var row = 48;

// 1.2 ระบุช่วงวันที่ที่ต้องการ
var startDate = '2024-01-01';
var endDate = '2024-03-31';

// 1.3 กำหนดเปอร์เซ็นต์เมฆสูงสุดที่ยอมรับได้
var maxCloudCover = 10;


// =================================================================================
// TODO 2: ค้นหาและกรองชุดข้อมูลภาพ (ImageCollection) ตามเงื่อนไข
// เราจะใช้เงื่อนไขจาก TODO 1 มากรองชุดข้อมูล Landsat 9
// =================================================================================

// 2.1 กรอง Image Collection ตาม Path, Row, ช่วงเวลา, และเปอร์เซ็นต์เมฆ
var filteredCollection = ee.ImageCollection('LANDSAT/LC09/C02/T1_TOA')
  .filter(ee.Filter.eq('WRS_PATH', path))                   // กรองตาม Path
  .filter(ee.Filter.eq('WRS_ROW', row))                     // กรองตาม Row
  .filterDate(startDate, endDate)                           // กรองตามช่วงเวลา
  .filter(ee.Filter.lt('CLOUD_COVER', maxCloudCover));      // กรองภาพที่มีเมฆน้อยกว่า 10%

// 2.2 พิมพ์ผลลัพธ์เพื่อตรวจสอบว่ามีภาพที่ตรงตามเงื่อนไขหรือไม่
// print('Collection ที่กรองแล้ว:', filteredCollection);

// 2.3 แสดงผลภาพทั้งหมดที่ผ่านการกรองบนแผนที่
// Map.addLayer(filteredCollection, {
//   bands: ['B4', 'B3', 'B2'],
//   max: 0.3
// }, 'Filtered Collection');


// =================================================================================
// TODO 3: เลือกภาพที่ดีที่สุดและดึงข้อมูล ID
// จาก Collection ที่กรองแล้ว เราจะเลือกมา 1 ภาพ (ภาพแรกสุด) เพื่อนำไปใช้งานต่อ
// =================================================================================

// 3.1 ดึงภาพแรก (ที่ดีที่สุด) ออกมาจาก Collection
// var firstImage = filteredCollection.first();

// 3.2 ดึงเอาเฉพาะ ID ของภาพนั้นออกมา
// var imageId = firstImage.id();

// 3.3 พิมพ์ ID ออกมาดูใน Console
// print('ID ของภาพแรกที่พบ:', imageId);


// =================================================================================
// TODO 4: การจัดการข้อมูลภาพเดี่ยว (ee.Image) โดยใช้ ID ที่ได้มา
// นำ ID ที่ได้จากขั้นตอนที่แล้ว มาสร้างเป็น Object ภาพเดี่ยวเพื่อวิเคราะห์ต่อ
// =================================================================================

// 4.1 สร้าง Object ประเภท Image โดยอ้างอิงจาก ID ที่เราค้นหามาได้
// var imageFromId = ee.Image('LANDSAT/LC09/C02/T1_TOA/LC09_130048_20240213');

// --- การเรียกใช้ Method ของ Object ประเภท Image ---
// 4.2 นับจำนวนแบนด์ทั้งหมดในภาพ
// var bandCount = imageFromId.bandNames().length();
// print('Band count:', bandCount);

// 4.3 ตรวจสอบชื่อแบนด์ทั้งหมดที่มีในภาพ
// var bandNames = imageFromId.bandNames();
// print('Band names:', bandNames);

// --- การแสดงผลบนแผนที่ ---

// 4.4 ซูมแผนที่ไปยังตำแหน่งของภาพ
// Map.centerObject(imageFromId, 9);

// 4.5 เพิ่ม Layer ของภาพเดี่ยวที่เลือกมาลงบนแผนที่ เพื่อเปรียบเทียบ
// Map.addLayer(imageFromId, {
//   bands: ['B4', 'B3', 'B2'],
//   min: 0,
//   max: 0.3000
// }, 'Single Image from ID');

```
---
# 3. Method Chaining
- Method Chaining คือเทคนิคการเขียนโค้ดโดยการเรียกใช้ฟังก์ชัน (Method) ต่อๆ กันไปเรื่อยๆ ในบรรทัดเดียว โดยใช้เครื่องหมายจุด . เป็นตัวเชื่อม เหมือนกับการต่อโซ่
```js
// =================================================================================
// TODO 0: กำหนดพื้นที่ตั้งต้น (Geometry)
// เราจะสร้างพื้นที่สี่เหลี่ยม (Polygon) เพื่อใช้ในการกรองข้อมูล
// =================================================================================
var geometry = ee.Geometry.Polygon([
  [
    [99.74963537611364, 17.112622728755497],
    [99.74963537611364, 16.753273777391442],
    [100.12022667481904, 16.753273777391442],
    [100.12022667481904, 17.112622728755497],
    [99.74963537611364, 17.112622728755497]
  ]
]);


// =================================================================================
// TODO 1: การเขียนโค้ดแบบไม่ใช้ Method Chaining (เปรียบเทียบ)
// วิธีนี้จะสร้างตัวแปรใหม่ในแต่ละขั้นตอน ทำให้โค้ดยาวขึ้น
// =================================================================================

// 1.1 เรียกใช้ภาพเดี่ยว
var image = ee.Image('LANDSAT/LC09/C02/T1_TOA/LC09_130048_20240213');

// 1.2 เลือกแต่ละแบนด์มาเก็บในตัวแปรแยกกัน
var band4 = image.select('B4');
var band3 = image.select('B3');
var band2 = image.select('B2');

// 1.3 รวมแบนด์กลับเข้าด้วยกัน
var rgb = band4.addBands(band3).addBands(band2);

// 1.4 แสดงผลภาพบนแผนที่
Map.centerObject(image, 10);
// หมายเหตุ: เราสามารถใช้ image.select(['B4', 'B3', 'B2']) เพื่อเลือกแบนด์ทีเดียวได้
Map.addLayer(image.select(['B4', 'B3', 'B2']), {min: 0.0, max: 0.3}, 'RGB (Non-chaining)');


// =================================================================================
// TODO 2: การใช้ Method Chaining กับ ImageCollection
// วิธีนี้จะเชื่อมต่อแต่ละคำสั่งเข้าด้วยกัน ทำให้โค้ดสั้นและอ่านง่าย
// =================================================================================

// var collection = ee.ImageCollection('LANDSAT/LC09/C02/T1_TOA')
//     .filterDate('2024-01-01', '2024-03-31')   // 1. กรองตามวันที่
//     .filterBounds(geometry)                   // 2. กรองเฉพาะภาพที่อยู่ในพื้นที่ geometry
//     .select(['B5', 'B4', 'B3', 'B2'])         // 3. เลือกแบนด์ที่ต้องการ
//     .mean();                                  // 4. คำนวณค่าเฉลี่ยของทุกภาพที่กรองมาได้ เช่น .first(), mean(), .mosaic()

// Map.addLayer(collection, {bands: ['B4', 'B3', 'B2'], min: 0.0, max: 0.3}, 'Mean Image (Chaining)');


// =================================================================================
// TODO 3: การใช้ Method Chaining ร่วมกับฟังก์ชัน (.map)
// เราสามารถสร้างฟังก์ชันเอง แล้วใช้ .map() เพื่อสั่งให้ฟังก์ชันนั้นทำงานกับทุกภาพใน Collection
// =================================================================================

// 3.1 สร้างฟังก์ชันสำหรับคำนวณค่า NDVI
function calculateNDVI(image) {
    // .normalizedDifference คือสูตร (NIR - Red) / (NIR + Red)
    // สำหรับ Sentinel-2 คือ (B8 - B4) / (B8 + B4)
    return image.normalizedDifference(['B8', 'B4']).rename('NDVI');
}

// 3.2 ใช้ Method Chaining และ .map()
// var filtered = ee.ImageCollection('COPERNICUS/S2_SR_HARMONIZED')
//     .filterDate('2024-01-01', '2024-03-31')   // 1. กรองตามวันที่
//     .filterBounds(geometry)                   // 2. กรองตามพื้นที่
//     .map(calculateNDVI)                       // 3. **ส่งฟังก์ชัน calculateNDVI เข้าไปทำงานกับทุกภาพ**
//     .select('NDVI')                           // 4. เลือกเฉพาะแบนด์ NDVI ที่คำนวณเสร็จแล้ว
//     .mean();                                  // 5. หาค่าเฉลี่ยของ NDVI

// Map.addLayer(filtered, {min: 0, max: 1, palette: ['blue', 'white', 'green']}, 'Mean NDVI (Chaining with Map)');

```
---
# 4. NDVI Calculation Workflow
```js
// =================================================================================
// TODO 1: กำหนดพื้นที่และเงื่อนไขการค้นหาข้อมูล
// ในส่วนนี้ เราจะกำหนดพื้นที่ที่สนใจและกรองข้อมูลภาพถ่ายดาวเทียม Sentinel-2
// =================================================================================

// 1.1 กำหนดพื้นที่ตั้งต้น (Geometry) เพื่อใช้ในการกรองข้อมูล
var geometry = ee.Geometry.Polygon([
  [
    [99.74963537611364, 17.112622728755497],
    [99.74963537611364, 16.753273777391442],
    [100.12022667481904, 16.753273777391442],
    [100.12022667481904, 17.112622728755497],
    [99.74963537611364, 17.112622728755497]
  ]
]);

// 1.2 กรองชุดข้อมูล (ImageCollection) ของ Sentinel-2 ตามช่วงวันที่และพื้นที่ที่กำหนด
var s2 = ee.ImageCollection('COPERNICUS/S2_SR_HARMONIZED')
  .filterDate('2025-02-01', '2025-06-28')
  .filterBounds(geometry);


// =================================================================================
// TODO 2: สร้างภาพสังเคราะห์ (Composite) เพื่อลดผลกระทบจากเมฆ
// เราจะรวมภาพทั้งหมดที่กรองมาได้ให้เป็นภาพเดียวโดยใช้ค่ามัธยฐาน (Median)
// =================================================================================

// 2.1 สร้างภาพสังเคราะห์จากค่ามัธยฐานของทุกพิกเซลใน Collection
var composite = s2.median();


// =================================================================================
// TODO 3: คำนวณค่าดัชนีพืชพรรณ (NDVI)
// NDVI คือค่าที่บ่งบอกความสมบูรณ์ของพืชพรรณ คำนวณจากแบนด์ Near-Infrared (NIR) และ Red
// =================================================================================

// 3.1 คำนวณ NDVI โดยใช้ฟังก์ชัน normalizedDifference()
// สูตรคือ (NIR - Red) / (NIR + Red) หรือ (B8 - B4) สำหรับ Sentinel-2
var ndvi = composite.normalizedDifference(['B8', 'B4']).rename('NDVI');

// 3.2 เพิ่มแบนด์ NDVI ที่คำนวณได้เข้าไปในภาพ composite เดิม
var compositeWithNDVI = composite.addBands(ndvi);

// 3.3 พิมพ์ข้อมูลของภาพสุดท้ายเพื่อตรวจสอบแบนด์ทั้งหมด
print('Image with NDVI:', compositeWithNDVI);


// =================================================================================
// TODO 4: กำหนดค่าการแสดงผลและเพิ่ม Layer บนแผนที่
// เราจะกำหนดชุดสี (Palette) เพื่อให้มองเห็นค่า NDVI ได้ง่าย และนำไปแสดงผล
// =================================================================================

// 4.1 กำหนดชุดสีสำหรับแสดงผล NDVI (ค่าต่ำไปสูง: น้ำตาล -> เหลือง -> เขียว)
var palette = [
  'FFFFFF', 'CE7E45', 'DF923D', 'F1B555', 'FCD163', '99B718',
  '74A901', '66A000', '529400', '3E8601', '207401', '056201',
  '004C00', '023B01', '012E01', '011D01', '011301'
];

// 4.2 กำหนดพารามิเตอร์การแสดงผล โดยระบุค่า min, max และชุดสี
var ndviVis = {
  min: 0,
  max: 0.7,
  palette: palette
};


// 4.3 เพิ่มชั้นข้อมูล (Layer) ของ NDVI ลงบนแผนที่
Map.centerObject(geometry, 10);
Map.addLayer(compositeWithNDVI.select('NDVI'), ndviVis, 'NDVI');

// 4.4 Clip bbox geometry
// var clippedNdvi = compositeWithNDVI.clip(geometry);
// Map.addLayer(clippedNdvi.select('NDVI'), ndviVis, 'NDVI Clip');

```
